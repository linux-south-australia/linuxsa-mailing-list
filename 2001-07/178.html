<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="RE: squid running to aliased IPs, and user IP accounting" -->
<!-- FromName="'David Rowlands'" -->
<!-- FromEmail="davidr@empower.com.au" -->
<!-- ToName="'Toby Corkindale'" -->
<!-- ToEmail="tjcorkin@sa.pracom.com.au" -->
<!-- Date="Thu, 5 Jul 2001 11:25:06 +0930" -->
<!-- Id="51AEEE2767C2D311843A00A0CC51043F330B14@EINSTEIN" -->
<!-- Reference="" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: RE: squid running to aliased IPs, and user IP accounting</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: David Rowlands &lt;<I><A HREF="mailto:davidr@empower.com.au">davidr@empower.com.au</A></I>&gt;
  To  : Toby Corkindale &lt;<I><A HREF="mailto:tjcorkin@sa.pracom.com.au">tjcorkin@sa.pracom.com.au</A></I>&gt;
  Date: Thu, 5 Jul 2001 11:25:06 +0930
</PRE>
<H1>RE: squid running to aliased IPs, and user IP accounting</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Toby,

No, I haven't tried it with iptables unfortunately.

&gt; -----Original Message-----
&gt; From: Toby Corkindale [mailto:<A HREF="mailto:tjcorkin@sa.pracom.com.au">tjcorkin@sa.pracom.com.au</A>]
&gt; Sent: Thursday, July 05, 2001 11:21 AM
&gt; To: David Rowlands
&gt; Cc: '<A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A>'
&gt; Subject: RE: squid running to aliased IPs, and user IP accounting
&gt; 
&gt; 
&gt; Cheers David,
&gt; 
&gt; one question - the FAQ looks like it only works with pre-iptables
&gt; firewalling? (for ipac 1.x anyway)
&gt; Have you got it running with iptables?
&gt; 
&gt; Toby
&gt; 
&gt; On Thu, 5 Jul 2001, David Rowlands wrote:
&gt; 
&gt; &gt; Toby,
&gt; &gt;
&gt; &gt; I'm doing something very similar.
&gt; &gt;
&gt; &gt; I use a utility called ipac to monitor bandwidth. You can find it at
&gt; &gt; <A HREF="http://www.comlink.apc.org/~moritz/ipac.html">http://www.comlink.apc.org/~moritz/ipac.html</A>
&gt; &gt;
&gt; &gt; It produces nice graphs etc. The docs say you can do it on 
&gt; a per IP basis,
&gt; &gt; but it gets tricky if you are using ip masquerading, but it 
&gt; can be done and
&gt; &gt; it tells you how.
&gt; &gt;
&gt; &gt; I have actually used it on my network at home, and can get 
&gt; very good stats
&gt; &gt; on how much bandwitdth each IP address is using.
&gt; &gt;
&gt; &gt; Let me know if you need more info.
&gt; &gt;
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt; From: Toby Corkindale [mailto:<A HREF="mailto:tjcorkin@sa.pracom.com.au">tjcorkin@sa.pracom.com.au</A>]
&gt; &gt; &gt; Sent: Thursday, July 05, 2001 10:50 AM
&gt; &gt; &gt; To: <A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A>
&gt; &gt; &gt; Subject: squid running to aliased IPs, and user IP accounting
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hiya
&gt; &gt; &gt;
&gt; &gt; &gt; I never seem to get replies to my questions, but here's
&gt; &gt; &gt; another one anyway..
&gt; &gt; &gt;
&gt; &gt; &gt; First Q:
&gt; &gt; &gt; I want to do IP accounting on a per-user basis. I was 
&gt; sure there was
&gt; &gt; &gt; something around to do this on linux - can someone point me
&gt; &gt; &gt; in the right
&gt; &gt; &gt; direction?
&gt; &gt; &gt;
&gt; &gt; &gt; Second Q:
&gt; &gt; &gt; I've also been trying to get squid running on several
&gt; &gt; &gt; different IPs. Not for
&gt; &gt; &gt; incoming requests, but using the tcp_outgoing parameter to
&gt; &gt; &gt; set the IP it
&gt; &gt; &gt; uses to retreive things itself. The idea being that I can use
&gt; &gt; &gt; iptables to
&gt; &gt; &gt; account for the bandwidth to the different IPs.
&gt; &gt; &gt; (and have all the squids peer to a central server and/or 
&gt; each other)
&gt; &gt; &gt;
&gt; &gt; &gt; The problem is, I can't even get this to work with a single
&gt; &gt; &gt; squid & single
&gt; &gt; &gt; IP address.
&gt; &gt; &gt; Everything works fine, until i set the tcp_outgoing address to be
&gt; &gt; &gt; 192.168.0.40, which is an aliased ip on eth0:1.
&gt; &gt; &gt; At this point, squid seems to fail to connect to anything 
&gt; external.
&gt; &gt; &gt; I've failed to figure out why - squid succeeds when it does
&gt; &gt; &gt; the initial DNS
&gt; &gt; &gt; tests, btw. Accorrding to tcpdump i don't even see squid
&gt; &gt; &gt; attempt to connect
&gt; &gt; &gt; to the destination website though?
&gt; &gt; &gt;
&gt; &gt; &gt; Has anyone had something like this going?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; If I can get per-user accounting, then I'll just run each 
&gt; squid as a
&gt; &gt; &gt; different user. Easy.
&gt; &gt; &gt; I need the per-user stuff anyway, for the users themselves.
&gt; &gt; &gt; However, I can see myself ending up writing a perl script to rip
&gt; &gt; &gt; cache-misses data per user for a single squid cache, although
&gt; &gt; &gt; this isn't so
&gt; &gt; &gt; accurate.
&gt; &gt; &gt; Also, I've considered running one squid, thats only listening
&gt; &gt; &gt; on loopback,
&gt; &gt; &gt; and then have a pass-thru proxy (eg. perl script or
&gt; &gt; &gt; something) sitting on
&gt; &gt; &gt; multiple aliased IPs, that just pass thru to the main squid
&gt; &gt; &gt; proxy, and keep
&gt; &gt; &gt; track of the data flowing both ways.
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt;
&gt; &gt; &gt; Toby
&gt; &gt; &gt;
&gt; &gt; &gt; np. Snog - The prole song
&gt; &gt; &gt;
&gt; 

-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
