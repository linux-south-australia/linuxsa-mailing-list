<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Automatic Power-off upon Shutdown" -->
<!-- FromName="" -->
<!-- FromEmail="branko@senet.com.au" -->
<!-- ToName="" -->
<!-- ToEmail="linuxsa@linuxsa.org.au" -->
<!-- Date="Wed, 18 Jul 2001 21:22:34 +0930 (CST)" -->
<!-- Id="E15MpsY-0000GD-00@scorpio" -->
<!-- Reference="" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Automatic Power-off upon Shutdown</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: &lt;<I><A HREF="mailto:branko@senet.com.au">branko@senet.com.au</A></I>&gt;
  To  : &lt;<I><A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A></I>&gt;
  Date: Wed, 18 Jul 2001 21:22:34 +0930 (CST)
</PRE>
<H1>Automatic Power-off upon Shutdown</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Help! I've run out of ideas for fault finding the inability
of my computer to shut down the ATX power supply. If anyone
has discovered some trick to use or some advice on how to
investigate further, I'd love to hear it.  

The story so far...

I have configured my machine to wake up early each morning,
call my ISP to collect mail and news, do its cron things
and then shutdown.  Problem is that, I need to manually 
switch it off.  

Now according to the web site by the maker of my motherboard,
a BIOS update has been issued with this description: "Fixed 
Linux shutdown issue".  My motherboard is an Epox EP-MVP3G.
The quoted BIOS update has been downloaded and flashed.
BIOS is by Award Software inc. CPU is AMD K6 350MHz. Linux
is Debian 2.2r0.  Kernel 2.2.17 has been compiled with every
combination of APM options that seem to make any sense, including
the "Use direct BIOS call" option and various APM on/off combos
that are applicable to laptops.  Still no luck.

Investigation of the kernel code has revealed that attempts
are made to activate the shutdown feature.  I have even put in
printk statements at various places to prove that the calls
to either BIOS or APM are being made, however, I have no proof
that the correct (for my MB) protocol is used.  I have not been 
able to prove that the BIOS would obey the power off command -
for one thing I don't have a Windowz OS to test the supplied CDROM
software.  What's more, I have copied the i386 instructions
from the kernel where the direct BIOS call is made and written
a small assembly program that results in a segmentation fault
when run.  I even tried to copy the op-codes into a DOS .com
file, running it has frozen DOS in one situation and resulted
in a error message and reboot under different circumstances.

According to some comments in the kernel code, RTC register
0x0f is for a shutdown byte.  The bios manual confirms this!
Attempts to load all 1's or all 0's in this location only 
screw the bios checksum and result in a complaint on next reboot.  

My reason to believe that the hardware is capable of shutting
down the ATX supply is as follows.  One of the BIOS options is
for the front panel power switch to require 4 second press in 
order to shutdown. This works as documented, so the firmware
must have control over the power off circuit.

At my wits end on this one...
-- 
Branko Bratkovic

-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
