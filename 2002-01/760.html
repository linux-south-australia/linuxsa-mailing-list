<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: dead smb connections" -->
<!-- FromName="'Toby Corkindale'" -->
<!-- FromEmail="tjcorkin@sa.pracom.com.au" -->
<!-- ToName="'Mike O'Connor'" -->
<!-- ToEmail="mike@pineview.net" -->
<!-- Date="Thu, 31 Jan 2002 14:57:20 +1030 (CST)" -->
<!-- Id="Pine.LNX.4.33.0201311454420.28566-100000@localhost.localdomain" -->
<!-- Reference="007001c1aa0b$dd133430$1ef621cb@themaster" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: dead smb connections</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: Toby Corkindale &lt;<I><A HREF="mailto:tjcorkin@sa.pracom.com.au">tjcorkin@sa.pracom.com.au</A></I>&gt;
  To  : Mike O &lt;<I><A HREF="mailto:mike@pineview.net">mike@pineview.net</A></I>&gt;
  Date: Thu, 31 Jan 2002 14:57:20 +1030 (CST)
</PRE>
<H1>Re: dead smb connections</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
What on earth are you guys doing?!?

I mount samba shares from my server at home, then turn off the pcs the
shares were on all the time.. The server realises and the next time i access
the share it pauses briefly, then gives me an error and then unmounts the
broken share.

I remember I had problems like you're describing sometime around the redhat
5.x era though.

Examine your setup to see if you're using hard mounts (which are
non-interruptable) or particularly long timeouts somewhere?

Toby

On Thu, 31 Jan 2002, Mike O'Connor wrote:

&gt; Hi Anthony
&gt;
&gt; This is a major problem which I have been hassling over for awhile, we have
&gt; a site using X terminal which uses a smb server on each terminal to make the
&gt; floppy drive available to the user.
&gt;
&gt; Some times the terminal crash, and leave the mounts on the server in a 'D'
&gt; state, when in this state they can not be killed and the only fix is to
&gt; REBOOT THE SERVER.
&gt;
&gt; We have over come this to a certain extent by using automount with a very
&gt; short mount time. From our testing it would seem that automount does the
&gt; mounting in a little different manner and this seem to stop or reduce the
&gt; chance of this deadlock.
&gt;
&gt; Cheers
&gt;   Mike O'Connor
&gt;
&gt;
&gt;
&gt; ----- Original Message -----
&gt; From: "Anthony Symons" &lt;<A HREF="mailto:ant@sa.pracom.com.au">ant@sa.pracom.com.au</A>&gt;
&gt; To: &lt;<A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A>&gt;
&gt; Sent: Thursday, January 31, 2002 11:58 AM
&gt; Subject: dead smb connections
&gt;
&gt;
&gt; &gt; What are you supposed to do when you have a samba connection to a
&gt; &gt; windows box, and you are copying files and playing mp3s off of it, then
&gt; &gt; the windows box dies, and all the samba stuff stops responding? I can
&gt; &gt; kill xmms, and the processes that were doing the copying, but I get this
&gt; &gt; sort of stuff:
&gt; &gt;
&gt; &gt; [<A HREF="mailto:root@ant">root@ant</A> root]# umount -f /mnt/pharrison
&gt; &gt; umount2: Device or resource busy
&gt; &gt; umount: <A HREF="file://pharrison/music:">file://pharrison/music:</A> not found
&gt; &gt; umount: /mnt/pharrison: Illegal seek
&gt; &gt; umount2: Device or resource busy
&gt; &gt; umount: /mnt/pharrison: device is busy
&gt; &gt;
&gt; &gt; and if I do:
&gt; &gt;
&gt; &gt; [<A HREF="mailto:root@ant">root@ant</A> root]# lsof |grep pharrison
&gt; &gt;
&gt; &gt; then it just hangs there for ages presumably waiting for something to
&gt; &gt; time out. Same if I hit tab in my mnt directory as it trys to stat the
&gt; &gt; dud share or something like that.
&gt; &gt;
&gt; &gt; I cant kill the smbfs mount processes either:
&gt; &gt;
&gt; &gt; [<A HREF="mailto:root@ant">root@ant</A> root]# ps -ax |grep music
&gt; &gt;  2081 ?        D      0:00 /sbin/mount.smbfs <A HREF="file://pharrison/music">file://pharrison/music</A>
&gt; &gt; /mnt/pharrison -o
&gt; &gt;  2276 pts/8    S      0:00 grep music
&gt; &gt;
&gt; &gt; [<A HREF="mailto:root@ant">root@ant</A> root]# kill -9 2081
&gt; &gt;
&gt; &gt; [<A HREF="mailto:root@ant">root@ant</A> root]# ps -ax |grep music
&gt; &gt;  2081 ?        D      0:00 /sbin/mount.smbfs <A HREF="file://pharrison/music">file://pharrison/music</A>
&gt; &gt; /mnt/pharrison -o
&gt; &gt;  2278 pts/8    S      0:00 grep music
&gt; &gt;
&gt; &gt; So, the windows box died, I dont care about alerting it of my
&gt; &gt; disconnection or anything, and I dont care what happens to any processes
&gt; &gt; that are trying to use that share, but how do I get my box fixed so I
&gt; &gt; can reconnect the share?
&gt; &gt;
&gt; &gt; Ant
&gt; &gt;
&gt; &gt;
&gt; &gt; --
&gt; &gt; Systems Administrator
&gt; &gt; Pracom Ltd.
&gt; &gt; +61 8 82029074 -=- +61 402 100 671
&gt; &gt; <A HREF="mailto:anthony.symons@sa.pracom.com.au">anthony.symons@sa.pracom.com.au</A>
&gt; &gt;
&gt; &gt; PRIVILEGED - PRIVATE AND CONFIDENTIAL
&gt; &gt; This electronic mail is solely for the use of the addressee and may
&gt; &gt; contain information which is confidential or privileged.
&gt; &gt; If you receive this electronic mail in error, please delete it from
&gt; &gt; your system immediately and notify the sender by electronic mail or
&gt; &gt; using any of the above contact details.
&gt; &gt;
&gt; &gt; --
&gt; &gt; LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
&gt; &gt; To unsubscribe from the LinuxSA list:
&gt; &gt;   mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject
&gt;
&gt;

-- 
 Toby Corkindale
 UNIX Developer, Core Tech R&D
 Technology SA, Pracom Ltd
 288 Glen Osmond Road
 Fullarton,	5063
 South Australia
 Tel: +61 8 8202 9075
 Fax: +61 8 8202 9001
 mailto:<A HREF="mailto:Toby.Corkindale@sa.pracom.com.au">Toby.Corkindale@sa.pracom.com.au</A>
 <A HREF="http://www.sa.pracom.com.au/">http://www.sa.pracom.com.au/</A>

                  PRIVILEGED - PRIVATE AND CONFIDENTIAL

   Privileged/Confidential Information may be contained in this message.
   If you are not the addressee indicated in this message, you may not
   copy or deliver this message to anyone.  In such case, you should
   destroy this message and notify the sender by reply email. Opinions,
   conclusions and other information in this message that do not relate
   to the official business of this organisation shall be understood as
   neither given nor endorsed by it.

-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
