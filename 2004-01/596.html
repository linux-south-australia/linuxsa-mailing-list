<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Diffing 2 images - Done" -->
<!-- FromName="'steve'" -->
<!-- FromEmail="steve@smartfab.com.au" -->
<!-- ToName="'Linuxsa'" -->
<!-- ToEmail="linuxsa@linuxsa.org.au" -->
<!-- Date="16 Jan 2004 20:16:04 +1030" -->
<!-- Id="1074246351.3899.33.camel@lah" -->
<!-- Reference="1074036850.8893.13.camel@tk" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Diffing 2 images - Done</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: steve &lt;<I><A HREF="mailto:steve@smartfab.com.au">steve@smartfab.com.au</A></I>&gt;
  To  : Linuxsa &lt;<I><A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A></I>&gt;
  Date: 16 Jan 2004 20:16:04 +1030
</PRE>
<H1>Diffing 2 images - Done</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Re: Taking 2 images, and creating a 3rd image that contains only the
differences between the first 2.

I got it working after a while.

Initially, it only takes about 10 lines of C code to perform the trick -
no big drama, but that is when the fun starts.

Seems like AutoCrud, in it's wisdom, sets arbitary colors for things on
some sort of whim algorithm.  If you have a pure white box, and add a
button to the side of it - the white on all of the panels may or may not
change to some subtle shade of off-white. Also the exact location of the
pixels for un-changed parts may shift 2-3 pixels in any direction. This
makes diffing the images a little interesting- you have to do the
straight diff, with a bit of a fudge factor for a 'difference threshold'
related to both color _and_ position. Pain the ass, but it can be done.
If the center of gravity of the object changes, AutoCAD will move the
object. Also, if the AutoCAD user makes any subtle change to the size of
their toolbars, this changes the entire resolution of the saved BMP
file. (Which is common if they have to knock up a number of views over a
period of time)

This is all an AutoCAD issue more than anything else (Mechanical desktop
/ inventor) - get a _real_ CAD package guys.

Anyway, after a couple of days of hacking, I now have some nice code
which does the following :

- Takes a set BMP files created by AutoCAD that represent an item with
the bare essentials.
- Another set of BMP files that represent the same item, but with a
bunch of accessories added on.
- Rotations of these images about a number of angles (30 / 45 deg steps)

Based on these files, the code produces a set of PNG images, culled down
suitable for web use, and using a lot of transparencies, such that they
can be overlayed on top of each other to produce a web-based
representation of an item with certain options selected on/off. The user
can then appear to rotate the object around and view the effects of
adding/deleting options. A bit like those Car sites that allow you to
change the color, or add a bullbar, etc, only this one allows you to
rotate the finished car around.

Note also that the initial C program generates the correct differences,
but these then need to be fed into a processing pipeline that 'convert'
from imagemagik is more than capable of handling from bash scripts.
(Check out convert some time if you have not already done so - its an
amazing utility, and should be installed hidden away as part of most
linux distros)

In a situation where you have a dozen optional items, each with 2-3
choices, there are way too many permutations of the finished product to
generate every possible combination as a set of images to save on the
server. Just a handful of PNG files and transparent overlays does the
trick.  Also, because it is all done with Javascript on the client,
there is no need to generate traffic or server requests when the user
clicks on options and rotates the image.  Of course, a little more
javasrcipt is needed to make the result work on IE at all (IE fails to
use transparency in PNG without jumping through hoops, and treating each
image as a directx control ...)

Using an AutoCAD 3D viewer web-plugin does not solve the problem at all
(because of the permutations). Flash could be used, but you still need
to generate transparent overlays, and Flash support on browsers is
generally bad.  WebStandards + PNG rocks.

I have 3-4 live websites that this code will be going on to in the near
future - they are all similar in that they are selling big-ticket
low-volume items that have a complex set of options and accessories. The
selector allows the user to play with the item they are considering in a
pseudo 3D viewer, with the options displayed.

----
Anyway, if anyone wants the code, ask.  I cant be bothered documenting
it.

----

What Id really like next is to have a decent AutoCAD / XGL file importer
into blender, and life would be so sweeeeet.

Get blender, If you use computers at all, then you NEED blender,
regardless of what you think you need a computer for :www.blender3d.org 

SteveOC



-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A> IRC: #linuxsa on irc.freenode.net
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
