<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: strange C code" -->
<!-- FromName="'Glen Turner'" -->
<!-- FromEmail="glen.turner@aarnet.edu.au" -->
<!-- ToName="'Jake Hawkes'" -->
<!-- ToEmail="jakehawkes2001@yahoo.com" -->
<!-- Date="Thu, 29 Nov 2001 10:51:40 +1030" -->
<!-- Id="3C057F94.5ED2BAA2@aarnet.edu.au" -->
<!-- Reference="20011128132952.45076.qmail@web20108.mail.yahoo.com" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: strange C code</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: Glen Turner &lt;<I><A HREF="mailto:glen.turner@aarnet.edu.au">glen.turner@aarnet.edu.au</A></I>&gt;
  To  : Jake Hawkes &lt;<I><A HREF="mailto:jakehawkes2001@yahoo.com">jakehawkes2001@yahoo.com</A></I>&gt;
  Date: Thu, 29 Nov 2001 10:51:40 +1030
</PRE>
<H1>Re: strange C code</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Michael Wardle wrote:
&gt; 
&gt; &gt; #include &lt;stdio.h&gt;
&gt; &gt;
&gt; &gt; void main(void)
&gt; &gt; {
&gt; &gt;         switch(1)
&gt; &gt;         {
&gt; &gt;         default:
&gt; &gt;                 printf("default");
&gt; &gt;         case 2:
&gt; &gt;                 printf("2\n");
&gt; &gt;                 break;
&gt; &gt;         case 1:
&gt; &gt;                 printf("1\n");
&gt; &gt;                 break;
&gt; &gt;         }
&gt; &gt; }
&gt; &gt;
&gt; &gt;
&gt; &gt; waddaya reckon the output would be?
&gt; 
&gt; I think the thing of interest here is supposed to be the inclusion of
&gt; the "default" case at the first case, whereas it is traditionally listed
&gt; last.  C seems to do the logical thing here and do case 1, but other
&gt; languages (such as Ada) may have different results for equivalent code.

It's the logical thing if you are used to compiled languages.
People used to interpreted languages would expect the "default"
option to be executed.

The Principle of Least Surprise implies that "default" is
listed last, as is the case in every coding standard I
know of.

The sematics of the "default" label in a "switch" statement are

   [#5] The integer promotions are performed on the controlling
   expression.  The constant expression in each case  label  is
   converted   to   the   promoted   type  of  the  controlling
   expression.  If  a  converted  value  matches  that  of  the
   promoted   controlling  expression,  control  jumps  to  the
   statement following the matched case label.   Otherwise,  if
   there  is  a  default  label,  control  jumps to the labeled
   statement.  If no converted case constant expression matches
   and there is no default label, no part of the switch body is
   executed.

Note that the treatment of the "case" as a "goto" label
is unusual.  Most other languages use the Pascal-style
CASE where there is no fallthrough.

The code is particularly dangerous because of the unmarked
fallthrough on the default option -- a value other than
1 or 2 would output
  default
  2
Most lint C code style checkers would pick this up.

-- 
 Glen Turner                                 Network Engineer
 (08) 8303 3936      Australian Academic and Research Network
 <A HREF="mailto:glen.turner@aarnet.edu.au">glen.turner@aarnet.edu.au</A>          <A HREF="http://www.aarnet.edu.au/">http://www.aarnet.edu.au/</A>
--
 The revolution will not be televised, it will be digitised

-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
