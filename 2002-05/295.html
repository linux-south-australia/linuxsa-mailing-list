<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: IDE geometry detection" -->
<!-- FromName="'James Leone'" -->
<!-- FromEmail="jleone@pacbell.net" -->
<!-- ToName="'Richard Russell'," -->
<!-- ToEmail="richard@yellowgoanna.com,linuxsa@linuxsa.org.au" -->
<!-- Date="Tue, 07 May 2002 20:32:29 -0700" -->
<!-- Id="" -->
<!-- Reference="000101c1f617$ad87e690$0f00a8c0@skink" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: IDE geometry detection</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: James Leone &lt;<I><A HREF="mailto:jleone@pacbell.net">jleone@pacbell.net</A></I>&gt;
  To  : Richard Russell &lt;<I><A HREF="mailto:richard@yellowgoanna.com">richard@yellowgoanna.com</A></I>&gt;<BR>        &lt;<I><A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A></I>&gt;
  Date: Tue, 07 May 2002 20:32:29 -0700
</PRE>
<H1>Re: IDE geometry detection</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Hi Richard,

I care about your problems, but I think that I'm not good enough to 
solve them.

So, here is my feable attempt. My answer might right embarass me, but, I 
have to let you know that I appreciate your helpful attitude. Just 
remember, I am a CPA.

Ok, here goes the standard 'how new is your kernel? statement. I have 
seen some hardware problems because an older kernel was used. I would 
upgrade my kernel first.

My second guess, which may be way off too...maybe the the BIOS is not 
set for larger drives on the second channel.

To quote Dr. Evil "LBA? I don't know, Ijust heard that somewhere before..."
 
So, right now there is a good chance that nothing I said so far is 
useful to you because you are probably way more advanced than I am. :-[

But if the luck of the gods shine on me, I hope I helped.

James Leone





 



Richard Russell wrote:

&gt;Hi all,
&gt;
&gt;And the other half of that thread... (remember this also?):
&gt;
&gt;There is a moral to this story (which was going to be a question, but I
&gt;think it's ended up as a story... it's quite long, so don't bother
&gt;reading it if you aren't interested in my problems :)  ...
&gt;
&gt;&gt;Some time ago, I had an issue where a freeBSD box wouldn't 
&gt;&gt;auto-detect two identical drives as being the same geometry. 
&gt;&gt;Well, it's happenning again, but this time, I think I know 
&gt;&gt;what's causing it... The drives, in this case, are on 
&gt;&gt;separate IDE channels, both as slaves. On the primary 
&gt;&gt;channel, the master is an older (ATA66 or ATA33) HDD, and on 
&gt;&gt;the secondary channel, the master is a CDROM drive. The one 
&gt;&gt;on the secondary is being detected with a massively reduced 
&gt;&gt;number of cylinders, which ends up restricting the capacity 
&gt;&gt;to about 6G (should be ~40G). The one on the primary gets 
&gt;&gt;detected with heaps more cylinders, and a filesystem there 
&gt;&gt;has 35G capacity (which I assume is about right, given HDD 
&gt;&gt;manufacturer's interpretation of powers of 2, and filesystem 
&gt;&gt;overhead). This is approximately the same as I experienced on 
&gt;&gt;the FreeBSD machine, though I seem to recall it detecting the 
&gt;&gt;correct size, but wrong geometry in that case (it was a newer 
&gt;&gt;machine, and a newer HDD).
&gt;&gt;
&gt;&gt;Anyway, does anyone know (or have a reference that can tell 
&gt;&gt;me) what kind of interference one can get on IDE channels? 
&gt;&gt;for eg, I'm pretty sure that the fact that I'm mixing an 
&gt;&gt;ATA33 and an ATA100 drive on an ATA33 channel shouldn't 
&gt;&gt;matter (though the ATA100 drive will just run at ATA33 speed, 
&gt;&gt;right?)... I'm using an ATA66 80-core ribbon... Then there's 
&gt;&gt;the whole variety of PIO and UDMA modes and so on... I'd 
&gt;&gt;really like to know what I should be seeing on this machine 
&gt;&gt;given the combination of IDE devices...
&gt;&gt;
&gt;
&gt;
&gt;OK, here's the situation. The BIOS in this machine is crap. It's also
&gt;reasonably old (it's an Intel SR440BX board, I believe). It only does
&gt;ATA33. No worries, thinks I.
&gt;
&gt;It's set up as follows:
&gt;
&gt;hda: Old ATA33 Quantum Fireball ~4G
&gt;hdb: New ATA100 Seagate Barracuda 40G
&gt;hdc: Old CDROM of some description
&gt;hdd: New ATA100 Seagate Barracuda 40G
&gt;
&gt;RedHat 6.0 (I think) is installed on hda -- hdb and hdd are blank.
&gt;
&gt;Everything is connected with 80 core IDE ribbon. The BIOS seems to
&gt;autodetect hdb no worries. It's a slightly unconventional BIOS though,
&gt;and all it says is:
&gt;
&gt;	[AUTO]
&gt;Size	36xxxMb
&gt;
&gt;Which seems good enough to me.
&gt;
&gt;However, hdd does this:
&gt;
&gt;	[AUTO]
&gt;Size	0Mb
&gt;
&gt;Which seems wrong. I've tried this with and without the CDROM connected,
&gt;so there's no interference from that on the IDE channel.
&gt;
&gt;I've tried the [USER] setting, but it doesn't give me options for
&gt;setting the geometry, as far as I can tell, just the access method (LBA
&gt;mode, no of sectors to be read at once, PIO/DMA mode, etc)
&gt;
&gt;Now, when I boot up, and look at /proc/ide/hd[bd]/geometry, I get some
&gt;interesting results...
&gt;
&gt;It's approximately:
&gt;
&gt;hdb:
&gt;physical  4683/255/63
&gt;logical   4683/255/63
&gt;
&gt;hdd:
&gt;physical  4683/255/63
&gt;logical   753/255/63
&gt;
&gt;
&gt;(IIRC).
&gt;
&gt;OK, great. I can use cfdisk on hdb no worries, but on hdd, it spits. so
&gt;I use the -c and -h options to manually set the geometry. This appears
&gt;to work ok, and as fat as cfdisk is concerned, as long as I use those
&gt;options on hdd, it's happy.
&gt;
&gt;mke2fs on each -- takes forever (like half an hour or so)... no errors.
&gt;
&gt;Mount each -- decides it wasn't unmounted cleanly, and wants me to
&gt;fsck... but it mounts it anyway (eventually), and appears to work, but
&gt;doesn't give me much confidence.
&gt;
&gt;fsck each -- takes forever (half and hour or so again), heaps of errors,
&gt;yes to fix them all...
&gt;
&gt;mount again -- same errors...
&gt;
&gt;Interestingly, the errors are identical down to the digit.
&gt;
&gt;OK, at this point I'm confused. The fact that hdd doesn't seem happy
&gt;isn't _that_ surprising, as I forced its geometry. But hdb? huh? 
&gt;
&gt;Is there anything else I can try short of a BIOS Flash? I'm a little
&gt;reluctant to flash the BIOS, as it appears to be somewhat customised (go
&gt;LODIN -- though it's most likely just a splash image), and flashing
&gt;BIOSes is irritating (where do I get a DOS boot floppy from?)
&gt;
&gt;At this stage, after writing all this email, I've downloaded the PDF
&gt;manual from intel.com, and have read half of it, and notice the text
&gt;"NOTE: do not connect an ATA device as a slave on the same IDE cable as
&gt;an ATAPI master device" hidden in the section on BIOS features.
&gt;Thrills... Well, tonight, I shall return, and make hdd hdc and hdc hdd,
&gt;and see what happens. Moral: RTFM. Sub-moral: get more sleep.
&gt;
&gt;rr
&gt;


-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
