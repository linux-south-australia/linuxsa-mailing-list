<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: traffic shaping (was Detering Port Scanning - Slowing it down)" -->
<!-- FromName="'John Edwards'" -->
<!-- FromEmail="isplist@adam.com.au" -->
<!-- ToName="'Toby Corkindale'" -->
<!-- ToEmail="tjc@lost.net.au" -->
<!-- Date="Wed, 10 Jul 2002 10:51:38 +0930" -->
<!-- Id="3D2B8C22.3B7834F3@adam.com.au" -->
<!-- Reference="20020710084600.Y56855-100000@marbles.lost.net.au" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: traffic shaping (was Detering Port Scanning - Slowing it down)</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: John Edwards &lt;<I><A HREF="mailto:isplist@adam.com.au">isplist@adam.com.au</A></I>&gt;
  To  : Toby Corkindale &lt;<I><A HREF="mailto:tjc@lost.net.au">tjc@lost.net.au</A></I>&gt;
  Date: Wed, 10 Jul 2002 10:51:38 +0930
</PRE>
<H1>Re: traffic shaping (was Detering Port Scanning - Slowing it down)</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Toby Corkindale wrote:
 
&gt; I contemplated setting up a virtual IP address for the proxy per user,
&gt; which would have worked perfectly, except that every user would have their
&gt; own personal proxy IP which would be confusing for them.
&gt; I suppose this could be got around by using transparent redirects on the
&gt; firewall, but by the time I got up to this stage I was thinking that the
&gt; old method of bandwidth allocation had been far easier to implement and
&gt; went out to get beer.*
&gt; 
&gt; Has anyone else ever worked out a neat or elegant solution for that?

There's some stuff in the CVS for squid that lets you set ToS bits on
replies. I once contemplated setting the ToS differently on TCP replies
for a 'hit' or 'miss'. This would then allow you to traffic shape based
on IP ToS, allowing hits through at full speed, and 'expensive' data
through at a rate limited speed. If you set the same ToS on ALL data
that comes in from the Internet, you get a nifty way of differentiating
at any other place in your LAN, and then cache misses can be treated as
if they came straight from the Internet for charging.

You'd probably need to tweak some of the 'quick_abort' features to make
this fair, otherwise a user could start downloading, stop early, then
try again later for a 'free' download.

I did some work on this, and even got one of the squid core developers
interested, but then I got lazy and installed a couple of high-end cache
appliances instead :)

It might also be possible to hack squid to forward your request data
transparently to another squid with the original source IP on a miss, so
you can shape differently depending on which squid process answers your
request.

John Edwards

-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
