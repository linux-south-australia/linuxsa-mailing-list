<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Firewalling & cbq/sfq" -->
<!-- FromName="'Toby Corkindale'" -->
<!-- FromEmail="tjcorkin@sa.pracom.com.au" -->
<!-- ToName="" -->
<!-- ToEmail="linuxsa@linuxsa.org.au" -->
<!-- Date="Fri, 18 May 2001 10:52:38 +0930 (CST)" -->
<!-- Id="Pine.LNX.4.21.0105181017170.24092-100000@localhost.localdomain" -->
<!-- Reference="" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Firewalling & cbq/sfq</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: Toby Corkindale &lt;<I><A HREF="mailto:tjcorkin@sa.pracom.com.au">tjcorkin@sa.pracom.com.au</A></I>&gt;
  To  : &lt;<I><A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A></I>&gt;
  Date: Fri, 18 May 2001 10:52:38 +0930 (CST)
</PRE>
<H1>Firewalling & cbq/sfq</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Hiya,
Just re-subbing and de-lurking for a moment to see if anyone can help me out
with a firewall question..

I've been attempting to setup stochastic fairness queues (SFQ) as a
sub-discipline of the class-based queueing scheduler (CBQ) to limit
bandwidth used by internal masqueraded users (housemates) downloading thru
an external link.

Note that the LIMIT target of the iptables is not suitable for this purpose.

I'm pretty sure the queueing is all setup right to do the limiting - its
pretty nifty what you can do with the queues-within-queues system.

Here's where the problem is: I can't actually funnel the right packets into
the right queues.. I'm trying to do it based on a MARK from the iptables
firewall setup.

using "iptables -t mangle -L -v" i can see that packets are not matching the
rules I setup. Can anyone suggest what rules are appropriate to match
packets coming in on a ppp interface, and leaving thru the eth interface,
after being de-masqueraded..

The rules I have tried are using the mangle table (present in OUTPUT and
PREROUTING):
eg:
-t mangle -I PREROUTING -d users_ip -i ppp0 -j MARK --set-mark 1

and

-t mangle -I OUTPUT -d users_ip -s ! gateways_internal_ip -j MARK --set-mark
1

(users ip is of form 192.168.x.x, dialup IP is something like 203.x.x.x,
gateways_internal_ip would be 192.168.1.4 in this case..)

Neither of those rules will match any packets at all!

if i setup a rule on output and remove the -s ! gateways_int_ip, then it
matches all packets to the destination, but putting that rule back in stops
matching again..


A second question, for Alan Kennington.. (I hope this hasn't already been
discussed, i haven't checked any archives)
Whereabouts did you get the statistics for the statement that any online
server is potentially cracked five times every hour?


Thanks all,

Toby


(PS. Third question - anyone want to sell a cheap PalmOS compatible device
to me? ;) seeyas)

-- 
 Toby Corkindale
 UNIX Developer, Core Tech R&D
 Technology SA, Pracom Ltd
 288 Glen Osmond Road
 Fullarton,	5063
 South Australia
 Tel: +61 8 8202 9075
 Fax: +61 8 8202 9001
 mailto:<A HREF="mailto:Toby.Corkindale@sa.pracom.com.au">Toby.Corkindale@sa.pracom.com.au</A>
 <A HREF="http://www.sa.pracom.com.au/">http://www.sa.pracom.com.au/</A>

                  PRIVILEGED - PRIVATE AND CONFIDENTIAL

   Privileged/Confidential Information may be contained in this message.
   If you are not the addressee indicated in this message, you may not 
   copy or deliver this message to anyone.  In such case, you should   
   destroy this message and notify the sender by reply email. Opinions,
   conclusions and other information in this message that do not relate
   to the official business of this organisation shall be understood as
   neither given nor endorsed by it.


-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
