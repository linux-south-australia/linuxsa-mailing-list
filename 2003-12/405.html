<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: Frustrating samba locking" -->
<!-- FromName="'Matthew Geddes'" -->
<!-- FromEmail="mgeddes@tellurian.com.au" -->
<!-- ToName="" -->
<!-- ToEmail="khawtin@ratbaggames.com" -->
<!-- Date="12 Dec 2003 09:06:47 +1030" -->
<!-- Id="1071182207.1349.329.camel@hilarious" -->
<!-- Reference="Pine.LNX.4.44.0312091818030.10897-100000@cairo.rae.cx" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: Frustrating samba locking</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: Matthew Geddes &lt;<I><A HREF="mailto:mgeddes@tellurian.com.au">mgeddes@tellurian.com.au</A></I>&gt;
  To  : &lt;<I><A HREF="mailto:khawtin@ratbaggames.com">khawtin@ratbaggames.com</A></I>&gt;
  Date: 12 Dec 2003 09:06:47 +1030
</PRE>
<H1>Re: Frustrating samba locking</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
On Tue, 2003-12-09 at 18:15, Kim Hawtin wrote:
&gt; Kirsty Rae wrote:
&gt; &gt; If anyone has any suggestions on where to look to diagnose this problem I 
&gt; &gt; would really appreciate it.  If you need more information, I'll do my best 
&gt; &gt; to get it to you.  If you have enough information to recommend possible 
&gt; &gt; fixes, well even better.
&gt; 
&gt; this may be barking up the wrong tree, but have a look at the
&gt; unix permissions that files get created in the smb.conf file...

Good call. Just try not to give people too much control over a set of
files. :-)


&gt; and theres also;
&gt; 
&gt;     kernel oplocks = no
&gt; 
&gt; but i don't know that thats relavent ... =)
&gt; but also worth a look.

You'll find that oplocks have less to do with file access than they do
caching. From memory, being granted an opportunistic lock (oplock) on a
file gives an operating system permission to modify the file locally.
That oplock will be broken when another user tries opening that same
file. Unless you have a reason to, it's safest to leave oplocks alone.

The documentation that comes with Samba these days really is quite good.
For a start there's the man pages for the smb.conf file (smb.conf(5)),
but the O'Reilly published book 'Using Samba' is maintained by the Samba
team and is released under some kind of open license and is shipped with
the Samba source (and some binary packages). In fact, I think Using
Samba has a chapter on locking.

Here are some useful tools for diagnosing locking problems:

  lsof (lists open files)
  lslk (lists files locked at linux kernel level)
  smbstatus (lists files locked at Samba level)

You may also want to turn up the log level a little and see if log.smbd
contains anything useful.

Hope it helps,
Matt


-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A> IRC: #linuxsa on irc.freenode.net
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
