<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: fax with LPR" -->
<!-- FromName="Justin Hawkins" -->
<!-- FromEmail="justin@tardis.mx.com.au" -->
<!-- ToName="Brian Marr" -->
<!-- ToEmail="sirreg@dove.net.au" -->
<!-- Date="Mon, 9 Aug 1999 20:36:51 +0930 (CST)" -->
<!-- Id="Pine.BSF.4.10.9908091837090.729-100000@tardis.mx.com.au" -->
<!-- Reference="37AE0DDC.B4B17AA9@dove.net.au" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: fax with LPR</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: Justin Hawkins &lt;<I><A HREF="mailto:justin@tardis.mx.com.au">justin@tardis.mx.com.au</A></I>&gt;
  To  : Brian Marr &lt;<I><A HREF="mailto:sirreg@dove.net.au">sirreg@dove.net.au</A></I>&gt;
  Date: Mon, 9 Aug 1999 20:36:51 +0930 (CST)
</PRE>
<H1>Re: fax with LPR</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
I don't do it quite in that way, but I have a nice setup with seamless
printing from Windows. It works like this:

o Windows box prints Postscript date to the Samba share \\server\fax

o Samba takes the printer data and pipes it into a fax script

o The perl fax script opens a TCP/IP connection back to the client
  requesting the fax information.

o The little client listening on the Windows box (freeware) pops up a
  dialog, asking for the fax number, name etc etc. Also has a little
  address book.

o It sends this data back to the script which continues, running sendfax
  and sending the fax off.

o The sender gets an email back telling them the status of the fax

All very neat.

For the converse I have mgetty setup to answer calls and receive faxes. If
it gets one it just prints it out on the printer, and sends email to alert
people a new fax has come in.

Since I don't have a dedicated data line, I use mgettys ringback feature.
If someone calls my number, hangs up after a couple of rings, then calls
back within 60 seconds, the modem answers. Also very neat.

For more information, do a web search for 'sendfax' and 'respond' and you
are sure to find it. Respond is the name is the freeware windows client
part of the deal. The web page also has the associated scripts and stuff.

The rest of the above is all stock mgetty+sendfax.

Sorry it doesn't solve your problem Brian, but I thought it might be of
interest anyway.

	- Justin



On Mon, 9 Aug 1999, Brian Marr wrote:

&gt; Is there anyone successfully faxing from lpr?
&gt; 
&gt; Having set up the appropriate printcap entry 
&gt; and sent a fax with 
&gt; 
&gt; lpr -Pfax -J 85643390 tmp.prn 
&gt; 
&gt; the modem is initiated and line connects but does not dial. It waits for
&gt; a while and then drops out. I have studied docs around setting up lpr
&gt; for faxing but no luck yet.
&gt; 
&gt; 
&gt; efax: Fri Aug  6 08:49:43 1999 argv[0]=/usr/bin/efax
&gt; efax: 49:43 argv[1]=-v
&gt; efax: 49:43 argv[2]=ewin
&gt; efax: 49:43 argv[3]=-v
&gt; efax: 49:43 argv[4]=chewmainrxtf
&gt; efax: 49:43 argv[5]=-d/dev/modem
&gt; efax: 49:43 argv[6]=-x
&gt; efax: 49:43 argv[7]=/var/spool/fax/LCK..modem
&gt; efax: 49:43 argv[8]=-iZ
&gt; efax: 49:43 argv[9]=-i&FE&D2S7=120
&gt; efax: 49:43 argv[10]=-i&C0
&gt; efax: 49:43 argv[11]=-iM1L0
&gt; efax: 49:43 argv[12]=-o1
&gt; efax: 49:43 argv[13]=-c
&gt; efax: 49:43 argv[14]=1,3,0,0,0,0,0,0
&gt; efax: 49:43 argv[15]=-l
&gt; efax: 49:43 argv[16]=0885642321
&gt; efax: 49:43 argv[17]=-kZ
&gt; efax: 49:43 argv[18]=-h
&gt; efax: 49:43 argv[19]=99/08/06 08:49  Brian Marr -Red Hat Linux system
&gt; (0885642321)  --&gt;    p. %d/%d
&gt; efax: 49:43 argv[20]=-t
&gt; efax: 49:43 argv[21]=
&gt; efax: 49:43 argv[22]=fax4749.001
&gt; efax: 49:43 created binary lock file /var/spool/fax/LCK..modem
&gt; efax: 49:43 opened /dev/modem
&gt; efax: 49:43 command  "Q0V1"
&gt; efax: 49:43 .181 [ATQ0V1&lt;CR&gt;&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 .191 [OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 response "OK"
&gt; efax: 49:43 command  "Z"
&gt; efax: 49:43 .301 [ATZ&lt;CR&gt;&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 .351 [OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 response "OK"
&gt; efax: 49:43 command  "&FE&D2S7=120"
&gt; efax: 49:43 .461 [AT&FE&D2S7=120&lt;CR&gt;&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 .551 [OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 response "OK"
&gt; efax: 49:43 command  "&C0"
&gt; efax: 49:43 .671 [&lt;CR&gt;&lt;LF&gt;OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 response "OK"
&gt; efax: 49:43 command  "M1L0"
&gt; efax: 49:43 .791 [&lt;CR&gt;&lt;LF&gt;OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 response "OK"
&gt; efax: 49:43 command  "+FCLASS=1"
&gt; efax: 49:43 .911 [&lt;CR&gt;&lt;LF&gt;OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 49:43 response "OK"
&gt; efax: 49:43 dialing 
&gt; efax: 49:43 command  "D"
&gt; efax: 50:01 .911 [&lt;CR&gt;&lt;LF&gt;BUSY&lt;CR&gt;&lt;LF&gt;]   -does not dial number.
&gt; efax: 50:01 response "BUSY"
&gt; efax: 50:01 Warning: number is busy
&gt; efax: 50:01 failed -&gt; fax4749.001
&gt; efax: 50:01 command  "Q0V1"
&gt; efax: 50:02 .031 [&lt;CR&gt;&lt;LF&gt;OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 50:02 response "OK"
&gt; efax: 50:02 command  "Z"
&gt; efax: 50:02 .191 [&lt;CR&gt;&lt;LF&gt;OK&lt;CR&gt;&lt;LF&gt;]
&gt; efax: 50:02 response "OK"
&gt; efax: 50:02 read binary pid 4781 from /var/spool/fax/LCK..modem (our
&gt; pid)
&gt; efax: 50:02 removed lock file /var/spool/fax/LCK..modem
&gt; efax: 50:02 done, returning 1
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; My fax script is below. I have tried adjusting some of the settings
&gt; without luck.
&gt; 
&gt; #!/bin/sh
&gt; # 
&gt; # fax - script to make, send, receive, view or print a fax
&gt; # Copyright 1993-1996 by Ed Casas 
&gt; # 
&gt; # --- Start of user configuration section --- 
&gt; # 
&gt; # Note: do not put spaces before or after the equal (=) signs.
&gt; #
&gt; 
&gt; # The names of the fax script, efax and efix including full path
&gt; # if necessary.
&gt; 
&gt; FAX=/usr/bin/fax
&gt; EFAX=/usr/bin/efax
&gt; EFIX=/usr/bin/efix
&gt; 
&gt; # The device to which the fax modem is connected (e.g. ttya for
&gt; # /dev/ttya).  Use a dial-out (cua) device if available.  If
&gt; # there are links to this device then all programs must use same
&gt; # name or the UUCP locking mechanism will fail.  For example, if
&gt; # /dev/modem is a link to /dev/cua1, then getty, uucp, kermit,
&gt; # pppd, dip, etc. must *all* use either /dev/modem or /dev/cua1.
&gt; 
&gt; DEV=modem
&gt; 
&gt; # The type of fax modem commands to use.  Un-comment one of the
&gt; # following lines depending on your modem.
&gt; 
&gt; CLASS=1
&gt; # CLASS=3
&gt; # CLASS=2.0
&gt; 
&gt; # Your fax number in international format, 20 characters maximum.
&gt; # Use only digits, spaces, and the "+" character.
&gt; 
&gt; FROM="0885642321"
&gt; 
&gt; # Your name as it should appear on the page header.
&gt; 
&gt; NAME="Brian Marr -Red Hat Linux system"
&gt; 
&gt; # The preferred page size for creating and printing faxes.
&gt; # Allowed values are "letter", "legal", and "a4".
&gt; 
&gt; # PAGE=letter
&gt; # PAGE=legal
&gt; PAGE=a4
&gt; 
&gt; # The type of printer. Use 'pcl' for HP-PCL or 'ps' for
&gt; # Postscript.  See definition of PRINT (below) for more options.
&gt; 
&gt; # PRTYPE=pcl				# HP-PCL (e.g. HP LaserJet) 
&gt; PRTYPE=ps				# Postscript (e.g. Apple LaserWriter)
&gt; 
&gt; # The command to print image files from standard input.  Typically
&gt; # this is "lpr" or "lp".
&gt; 
&gt; PRCMD="lpr"
&gt; 
&gt; # The command to view a Portable Gray Map (PGM) image from the
&gt; # standard input.  Typically "xv -" or "xloadimage stdin".
&gt; 
&gt; VIEWCMD="xv -"
&gt; # VIEWCMD="xloadimage stdin"		# alternative
&gt; # VIEWCMD="pnmtoxwd | xwud"		# alternative
&gt; 
&gt; # The name of the Ghostscript executable including full path if
&gt; # necessary.  Only required if faxing Postscript files.
&gt; 
&gt; GS=/usr/bin/gs
&gt; 
&gt; # Dial string prefix and suffix such as T for tone dialing, P for
&gt; # pulse dialing, 9 to get an external line, commas for delays or
&gt; # W to wait for dial tone.  See definition of TELCVT below if you
&gt; # have more complex requirements.
&gt; 
&gt; DIALPREFIX="ATDT"
&gt; DIALSUFFIX=""
&gt; 
&gt; # The name(s) of lock file(s) according to your system's
&gt; # conventions. Protect with single quotes for delayed evaluation.
&gt; # Add a leading '#' to the file name to use HDB (ASCII) format.
&gt; 
&gt; LOCK='-x /var/spool/fax/LCK..$DEV'		# "normal" systems
&gt; #LOCK=''					# no lock file
&gt; # LOCK='-x /usr/spool/locks/LK.047.040.011'	# SysV style names
&gt; # LOCK='-x #/usr/spool/uucp/LCK..$DEV'		# HDB format (ASCII pid)
&gt; # LOCK='-x /usr/spool/uucp/LCK/LCK..$DEV'	# NeXT
&gt; 
&gt; # Uncomment one of the following lines to force xon/xoff flow
&gt; # control if you have one of the types of modems listed.  
&gt; 
&gt; # FCINIT='-j\Q4'		# AT&T (Dataport, Paradyne)
&gt; # FCINIT='-j\Q1'		# Motorola (Power Modem, 3400 Pro,...)
&gt; # FCINIT='-j*F1'		# QuickComm (Spirit II)
&gt; # FCINIT='-j&H2'		# USR (Courier, Sportster)
&gt; 
&gt; # ****************************************************************
&gt; # The remaining options probably won't need to be changed.
&gt; # ****************************************************************
&gt; 
&gt; # Configuration files that are sourced if they exist.  Comment
&gt; # out if you don't need to use config files. Warning: any type of
&gt; # shell command in these files will be executed.
&gt; 
&gt; CONFIGFILES="/etc/efax.rc ${HOME:-~}/.efaxrc ./.efaxrc"
&gt; 
&gt; # A command that will generate unique names for logs and received
&gt; # files.  'date +%m%d%H%M%S' works on most systems.  Protect with
&gt; # single quotes.
&gt; 
&gt; TSTAMP='date +%m%d%H%M%S'
&gt; # TSTAMP='echo $$'		# alternative - use process number
&gt; 
&gt; # Shell command to convert aliases to phone numbers when sending
&gt; # faxes.  When executed $1 will be the alias and $f the file name
&gt; # to search.  The example below uses a directory file where alias
&gt; # lines start with the keyword "fax" followed by the alias in
&gt; # parentheses and a colon.  The remainder of the line is taken to
&gt; # be the phone number. Other lines are ignored.  For example, if
&gt; # one of the files in DIRFILES (defined below) contained the line
&gt; # "fax(kpmg): 691-3031", you could use the command "fax send kpmg
&gt; # invoice.24". Protect with single quotes.
&gt; 
&gt; LOOKUP='eval sed -n -e "/^fax($1):/{" -e "s/^[^:]*://p" -eq -e"}" $f'
&gt; 
&gt; # List of telephone directory file(s) to be searched.  The
&gt; # default is the file .faxdir in the user's home directory.
&gt; 
&gt; DIRFILES="${HOME:-.}/.faxdir"
&gt; 
&gt; # Shell command to convert phone numbers to dial strings.  This
&gt; # lets you to store numbers without the long distance or
&gt; # alternate carrier access codes, passwords, accounting digits,
&gt; # etc.  In the examples below this is used to convert numbers
&gt; # beginning with '+'; the first substitution handles same-country
&gt; # calls and the second handles international calls.
&gt; 
&gt; # TELCVT='sed -e s/+1/1/ -e s/+/011/'	# North America
&gt; TELCVT='sed -e s/+61/0/ -e s/+/0011/' # Australia
&gt; # TELCVT='sed -e s/+44/0/ -e s/+/00/'	# UK
&gt; # TELCVT='sed -e s/+49/0/ -e s/+/00/'	# Germany
&gt; # TELCVT='sed -e s/+852// -e s/+/001/'	# Hong Kong
&gt; # TELCVT='sed -e s/+33// -e s/+/19W/'	# France (?)
&gt; # TELCVT='sed -e s/+34/0/ -e s/+/07W/'	# Spain
&gt; # TELCVT='sed -e s/+1/10288/'		# use AT&T
&gt; # TELCVT='sed -e s/+/T82W1682W9W/'	# get out of PBX
&gt; 
&gt; # efix options to use a bitmap font for text-to-fax conversion.
&gt; # The option -l66 puts 66 lines of text per page, -d1,1 sets 1
&gt; # inch top & left margin.  Comment these out to use the built-in
&gt; # font. Use "fax makefont" to make bitmap fonts from Postscript
&gt; # fonts.
&gt; 
&gt; # TEXTFONT="-l66 -d1,1 -f /usr/bin/efaxfont"
&gt; 
&gt; # Dimensions of page sizes.
&gt; 
&gt; PAGE_letter="8.465x11in"	# fax width x letter length
&gt; PAGE_legal="8.465x14in"		# fax width x legal length
&gt; PAGE_a4="21x29.7cm"		# ISO A4
&gt; 
&gt; # Default resolution for converting to fax format. Can only be
&gt; # 204x196 or 204x98.
&gt; 
&gt; RES=204x196			# default "Fine" resolution (196 lpi)
&gt; # RES=204x98			# standard resolution (98 lpi)
&gt; 
&gt; # When the print and view commands below are executed, $f will be
&gt; # the input file name and $PAGEDIM will be one of the above page
&gt; # dimensions. Protect with single quotes.
&gt; 
&gt; # PRINT: A command to convert fax files to a printable format.
&gt; # For printers other than Postscript or PCL you can use efix's
&gt; # PBM output and an appropriate pbm filter (such as pbmtoepson)
&gt; # or efix's Postsript output and Ghostscript as a filter. Change
&gt; # the scaling (-s) and displacement (-d) options as required to
&gt; # fit the image onto the area your printer can print.
&gt; 
&gt; PRINT='$EFIX -ve -p$PAGEDIM -r300 -s0.98 -d0,0.125 -o$PRTYPE $f'
&gt; 
&gt; # example using pbm utilities:
&gt; # PRINT='$EFIX -ve -p$PAGEDIM -r60x72 -opbm $f | pbmtoepson'
&gt; 
&gt; # example using Ghostscript:
&gt; # PRINT='$EFIX -ve -p$PAGEDIM -r120x144 -ops $f | \
&gt; #	$GS -q  -sPAPERSIZE=$PAGE -sDEVICE=epson -r120x144 \
&gt; #	-dNOPAUSE -sOutputFile=- - '
&gt; 
&gt; # VIEW: A command to convert fax files to PGM format for
&gt; # previewing.  efix's pgm output reduces image dimensions by 4X.
&gt; 
&gt; VIEW='$EFIX -ve -p$PAGEDIM -r200 -opgm $f' 	# 50dpi: fast, whole-page
&gt; view
&gt; # VIEW='$EFIX -ve -p$PAGEDIM -r300 -opgm $f'	# 75dpi: slower, readable
&gt; size
&gt; 
&gt; # Commands to set up modem.  "-iZ -i&FE&D2S7=120 -i&C0"
&gt; # works with almost all modems.  See the efax(1) man page for
&gt; # details
&gt; 
&gt; INIT="-iZ -i&FE&D2S7=120 -i&C0"
&gt; 
&gt; # Command(s) to reset modem when efax finishes. "-kZ" works in
&gt; # almost all cases.
&gt; 
&gt; RESET="-kZ"
&gt; # RESET="-kZ -k&F+FCLASS=0"	# for modems that stay in fax mode after
&gt; reset
&gt; 
&gt; # Speaker mode(M) and loudness(L). Mn sets speaker mode where n
&gt; # means: 0:never, 1:until carrier, 2:always, 3:on receive only.
&gt; 
&gt; SPKR="-iM1L0"
&gt; 
&gt; # Options for different command sets.  Normally -o1 for Class 1,
&gt; # none for Class 2 and -o0 for Class 2.0.
&gt; 
&gt; CLASS1INIT="-o1"	# Class 1
&gt; CLASS2INIT=""		# Class 2
&gt; CLASS20INIT="-o0"	# Class 2.0
&gt; 
&gt; # The modem's capabilities for sending faxes.  "1,3,0,0,0,0,0,0"
&gt; # should almost always work. The second digit can be 5 for a
&gt; # 14,400 bps fax modem.  See the efax(1) man page for a
&gt; # description of the fields.
&gt; 
&gt; TXCAP="1,3,0,0,0,0,0,0"
&gt; 
&gt; # Capabilities for receiving faxes.  Usually the same as TXCAP.
&gt; # If your modem only receives at 4800 bps use "1,1,0,0,0,0,0,0".
&gt; 
&gt; RXCAP="$TXCAP"
&gt; 
&gt; # Additional options required only for transmit or only for
&gt; # receive.  None normally required.
&gt; 
&gt; RXINIT=""
&gt; TXINIT=""
&gt; 
&gt; # Command to make a date for the page header. Protect with single
&gt; # quotes.  'date "+%y/%m/%d %H:%M"' works on most systems.
&gt; 
&gt; DATECMD='date "+%y/%m/%d %H:%M"'	# YY/MM/DD HH:MM (24hour)
&gt; # DATECMD='date'			# longer, more readable
&gt; 
&gt; # Page header format.  You may use $DATE, $NAME, $FROM, $TO, and
&gt; # "%d/%d" (for page number and count).  Protect with single
&gt; # quotes.  Example: '$DATE $NAME ($FROM) --&gt; $TO p. %d/%d'.
&gt; 
&gt; HDR='$DATE  $NAME ($FROM)  --&gt;  $TO  p. %d/%d'
&gt; 
&gt; # BUSYRETRIES is a list of delays in seconds between attempts to
&gt; # redial busy numbers.  Comment out if you don't want to retry
&gt; # busy numbers.
&gt; 
&gt; #BUSYRETRIES="60 120 300 60 600 60 60 1200 60 60"
&gt; 
&gt; # FAILRETRIES is a list of delays in seconds between attempts to
&gt; # retry failed transmissions.  Retries are only attempted if at
&gt; # least one page was sent in the previous attempt. Retries
&gt; # include only pages not already sent. Comment out if you don't
&gt; # want to retry failed transmissions.
&gt; 
&gt; #FAILRETRIES="300 300"	# try two more times at 5 minute intervals
&gt; 
&gt; # Command to run another program (efax) at a higher-than-normal
&gt; # scheduling priority.  This command isn't used if it fails
&gt; # (e.g. because the current user isn't privileged).  Comment this
&gt; # out if it causes problems.
&gt; 
&gt; NICE="nice -n -10"
&gt; 
&gt; # Standard versions of commands that are often aliased.
&gt; 
&gt; RM="/bin/rm -f"
&gt; LS="/bin/ls"
&gt; 
&gt; # Types of messages to display.  VERB sets the messages displayed
&gt; # and VERBLOG the messages written to log files.
&gt; 
&gt; VERB="ewin"		# show errors, warnings, progress & negotiation
&gt; VERBLOG="chewmainrxtf"	# log everything
&gt; 
&gt; # ****************************************************************
&gt; # The remaining configuration options apply only to the `fax
&gt; # answer' command.  You can ignore these if you will only be
&gt; 
&gt; 
&gt; Any suggestions appreciated.
&gt; 
&gt; Brian Marr.
&gt; 
&gt; -- 
&gt; Check out the LinuxSA web pages at <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>
&gt; To unsubscribe from the LinuxSA list:
&gt;   mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject
&gt; 

-- 
Check out the LinuxSA web pages at <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
