<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: Blocking Code Red ingress to your ISP network" -->
<!-- FromName="'Simon Hackett'" -->
<!-- FromEmail="simon@internode.com.au" -->
<!-- ToName="'Alan Kennington','LinuxSA'" -->
<!-- ToEmail="akenning@topology.org,linuxsa@linuxsa.org.au" -->
<!-- Date="Sat, 11 Aug 2001 19:48:55 +0930" -->
<!-- Id="p05100301b79ab57c5e90@[150.101.234.83]" -->
<!-- Reference="20010810010719.A4046@dog.topology.org" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: Blocking Code Red ingress to your ISP network</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: Simon Hackett &lt;<I><A HREF="mailto:simon@internode.com.au">simon@internode.com.au</A></I>&gt;
  To  : Alan Kennington &lt;<I><A HREF="mailto:akenning@topology.org">akenning@topology.org</A></I>&gt;<BR>        LinuxSA &lt;<I><A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A></I>&gt;
  Date: Sat, 11 Aug 2001 19:48:55 +0930
</PRE>
<H1>Re: Blocking Code Red ingress to your ISP network</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
At 12:01 AM +0930 11/8/01, Alan Kennington wrote:
&gt;
&gt;John,
&gt;
&gt;It might be worse than that.

I think that you're wrong.

&gt;After thinking a bit longer, I think that it is not possible
&gt;to reduce byte load on a link through detection of the GET command.
&gt;
&gt;Here is a typical sequence:

[...]

&gt;
&gt;this typically goes on for a couple of minutes, with the
&gt;retransmission time doubling on each transmission.
&gt;(Linux does that anyway.)
&gt;
&gt;The result is clearly that I get more bytes of packets than I would
&gt;if I hadn't blocked it.

No, because -we- do the blocking, not you. So yes, -we- probably 
suffer the repeated packet retransmissions, but -we block all of 
them- and save you from all of them.

If you were one our customers by now, you could have verified that 
for yourself :)

&gt;If I don't block output packets from host V, then host V will send
&gt;ACKs for a while, and I think that C will also respond to these ACKs.
&gt;I've seen this happen many times when I've blocked bad hosts
&gt;on INPUT but not on OUTPUT.

It blocks the whole flow.

[...]

&gt;So the best strategy would be to add the host C to the list of
&gt;blocked hosts _after_ it has finished probing one host.
&gt;Then you won't get any more data bytes from it - just SYN packets.

No, it isn't, because this causes the collateral damage you noted below:

&gt;There are other problems of collateral damage:
&gt;-	Suppose you get CR probes from host C which is
&gt;	a proxy for 1000 employees.
&gt;	Then you block all of them from your website!
&gt;-	Suppose host C gets fixed.
&gt;	Then you're still blocking that site to
&gt;	genuine access after it's fixed.

Yes, so the above isn't a good idea, is it?

&gt;=======================================
&gt;So....
&gt;What exactly does the Cisco algorithm do?

<A HREF="http://www.cisco.com/warp/public/63/nbar_acl_codered.shtml">http://www.cisco.com/warp/public/63/nbar_acl_codered.shtml</A>

Read it for yourself. if you have the time to blow on this analysis, 
you should have the time to spend on understanding the full situation.

&gt;I imagine it just does a simple block as above
&gt;on INPUT only, without building up a list of
&gt;bad hosts.
&gt;If so, then it is bad on the incoming link to the Cisco router,
&gt;but good on the downstream.
&gt;And it would protect IIS servers which have not been patched.

It is context sensitive, to the extent that it does look 'both ways'; 
Indeed, it can't block the code red flow if it can't see both packet 
directions (asymmetric routing), and it also can't block it under 
some other circumstances as well (discussed in detail in the cisco 
web pages documenting their 'NBAR' feature -it's all publically 
accessible, just throw in some obvious keywords to the search engine 
at <A HREF="http://www.cisco.com">http://www.cisco.com</A> ; Cisco are one of the most open 
organisations there is when it coes to public disclosure of technical 
data about their offerings.

&gt;It's not clear what it does.

More than 30 seconds search on CCO would have answered those 
questions for you. Go to <A HREF="http://www.cisco.com">http://www.cisco.com</A> and type 'cisco and 
code red' into their search box.

Simon
-- 

---
Simon Hackett, Technical Director, Internode Systems Pty Ltd
31 York St [PO Box 284, Rundle Mall], Adelaide, SA 5000 Australia
Email: <A HREF="mailto:simon@internode.com.au">simon@internode.com.au</A>  Web: <A HREF="http://www.on.net">http://www.on.net</A>
Phone: +61-8-8223-2999          Fax: +61-8-8223-1777

-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
