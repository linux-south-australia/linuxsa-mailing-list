<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: [DRBD-dev] A comparison of ENBD and DRBD, updated" -->
<!-- FromName="Richard Sharpe" -->
<!-- FromEmail="sharpe@ns.aus.com" -->
<!-- ToName="Marcelo Tosatti" -->
<!-- ToEmail="marcelo@conectiva.com.br" -->
<!-- Date="Tue, 24 Oct 2000 13:08:27 +0900" -->
<!-- Id="3.0.6.32.20001024130827.007c76a0@203.16.214.248" -->
<!-- Reference="3.0.6.32.20001021104739.00b8ee90@203.16.214.248" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: [DRBD-dev] A comparison of ENBD and DRBD, updated</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: Richard Sharpe &lt;<I><A HREF="mailto:sharpe@ns.aus.com">sharpe@ns.aus.com</A></I>&gt;
  To  : Marcelo Tosatti &lt;<I><A HREF="mailto:marcelo@conectiva.com.br">marcelo@conectiva.com.br</A></I>&gt;
  Date: Tue, 24 Oct 2000 13:08:27 +0900
</PRE>
<H1>Re: [DRBD-dev] A comparison of ENBD and DRBD, updated</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
At 12:01 AM 10/22/00 -0200, Marcelo Tosatti wrote:
&gt;
&gt;On Sat, 21 Oct 2000, Richard Sharpe wrote:
&gt;
&gt;&gt; Hi,
&gt;&gt; 
&gt;&gt; This is a resend of a message I sent out a little while ago, with some
&gt;&gt; additional information.
&gt;&gt; 
&gt;&gt; I am working on a project to replace an RSYNC run between two machines
&gt;&gt; every 20 minutes with something that mirrors the data at a lower layer, say
&gt;&gt; at the driver level.
&gt;&gt; 
&gt;&lt;snip&gt;
&gt;
&gt;&gt; Once I got it going, I found that I could I could write small files to the
&gt;&gt; network device, /dev/nda, but if I tried to write a large file, like 100MB,
&gt;&gt; it hung. I hope to give it another try soon.
&gt;
&gt;This was probably caused by a deadlock which only shows up with kernel
&gt;2.2.17. 

I am not yet using Linux 2.2.17. The 2.2.17 was a reference to the version
of ENBD.

&gt;You must apply two patches to fix this problem. One of them is against the
&gt;kernel (kernel-2.2.17-tcpalloc.patch) and the other one is against drbd
&gt;(kernel-2.2.17-drbd-deadlock.patch).
&gt;
&gt;You can find them both at
&gt;<A HREF="http://bazar.conectiva.com.br/~marcelo/ha/patches/">http://bazar.conectiva.com.br/~marcelo/ha/patches/</A>
&gt;
&gt;&gt; Next, I moved on to DRBD. I used version 0.5.7 of DRBD, and this version
&gt;&gt; compiled cleanly under RH 6.2.
&gt;&gt; 
&gt;&gt; I used drbdsetup to set up my mirror on both machines using the B protocol,
&gt;&gt; nominated the primary and built a file system on /dev/nb0 with mke2fs. This
&gt;&gt; all worked fine, but was slower than I was used to, and the disks rattled
&gt;&gt; on bith machines.
&gt;&gt; 
&gt;&gt; Then, because it was late, I left the machines running all night copying
&gt;&gt; 2GB or data from a file system on the the mirrored file system, and
&gt;&gt; deleting the data and copying it again.
&gt;&gt; 
&gt;&gt; However, I have recently found what I think is an operational problem with
&gt;&gt; DRBD, one that will cause lots of pain when you need less pain! If one of
&gt;&gt; your two mirrors are down (perhaps because it took a hardware fault), and
&gt;&gt; your new primary is rebooted, you cannot mount any of the /dev/nb? devices!
&gt;&gt; You have to mount the underlying local device.
&gt;
&gt;By default drbd tries to negotiate the size of the device being used with
&gt;the other node. It will not allow access to the device until negotiation
&gt;is done.
&gt;
&gt;Though in you specify the size of the device using option "-d" of
&gt;drbdsetup (in KBs). After you have done that, drbd will allow access to
&gt;the device.
&gt;
&gt;
&gt;
&gt;_______________________________________________
&gt;DRBD-devel mailing list
&gt;<A HREF="mailto:DRBD-devel@lists.sourceforge.net">DRBD-devel@lists.sourceforge.net</A>
&gt;<A HREF="http://lists.sourceforge.net/mailman/listinfo/drbd-devel">http://lists.sourceforge.net/mailman/listinfo/drbd-devel</A>
&gt;

Regards
-------
Richard Sharpe, <A HREF="mailto:sharpe@ns.aus.com">sharpe@ns.aus.com</A>
Samba (Team member, www.samba.org), Ethereal (Team member, www.zing.org)
Contributing author, SAMS Teach Yourself Samba in 24 Hours
Author, Special Edition, Using Samba


-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
