<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="Re: Routing / IP Tables Problem" -->
<!-- FromName="'John Edwards'" -->
<!-- FromEmail="isplist@adam.com.au" -->
<!-- ToName="'Matthew Thom'" -->
<!-- ToEmail="matt@subnet.net.au" -->
<!-- Date="Fri, 08 Feb 2002 16:42:55 +1030" -->
<!-- Id="3C636C67.F5B5BF33@adam.com.au" -->
<!-- Reference="FB834573F81C8A42880EB1EE5812B6B6B841@kryten" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: Re: Routing / IP Tables Problem</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: John Edwards &lt;<I><A HREF="mailto:isplist@adam.com.au">isplist@adam.com.au</A></I>&gt;
  To  : Matthew Thom &lt;<I><A HREF="mailto:matt@subnet.net.au">matt@subnet.net.au</A></I>&gt;
  Date: Fri, 08 Feb 2002 16:42:55 +1030
</PRE>
<H1>Re: Routing / IP Tables Problem</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Matthew Thom wrote:

&gt; The problem is that when a request comes in via eth1 to either
&gt; WWW1 or WWW2 the response returns out eth0 and apparently this
&gt; is a problems for our friends at Tel$tra.

eth0 is set as your default route, so that's where all data will go
unless there's a more specific route to send it out to.

One way of solving your problem is to give WWW1 and WWW2 more than one
internal address each. ie: give WWW1 10.0.0.101 and 10.0.0.102. When a
request comes in to IP address 203.0.1.1 forward it to 10.0.0.101 and
when a request comes in with destination 203.1.100.1 forward it to
10.0.0.102.

The web server should then respond on the IP address the query was made
to internally.

When that response comes back to the gateway, you will need to use
source routing to drive it out the same way it came in. Because you can
identify it's ingres by the source of the responding IP packets, you can
then send it out the correct interface.

For information on how to do this, have a look at the Linux 2.4 Advanced
Routing HOWTO, in the section called "Rules - routing policy database".

Hopefully NAT won't interfere with this, and it should do what you need. 

The other alternative is to setup BGP sessions with 1 or more of your
providers, but that's probably more hassle than it's worth to you. This
would definately be worthwhile if your provider has lower-priced or free
SAIX traffic.

John Edwards

-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A>  IRC: #linuxsa on irc.linux.org.au
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
