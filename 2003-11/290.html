<HTML>
<!-- EmailData="Start" -->
<!-- Version="1.1" -->
<!-- Subject="samba eating my processor" -->
<!-- FromName="'jonathan soong'" -->
<!-- FromEmail="jon.soong@imvs.sa.gov.au" -->
<!-- ToName="" -->
<!-- ToEmail="linuxsa@linuxsa.org.au" -->
<!-- Date="Mon, 17 Nov 2003 14:52:32 +1030" -->
<!-- Id="3FB84D08.3030402@imvs.sa.gov.au" -->
<!-- Reference="" -->
<!-- X-Face="" -->
<!-- X-URL="" -->
<!-- EmailData="End" -->
<HEAD>
<TITLE>LinuxSA Mailing List: samba eating my processor</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF><H1>LinuxSA Mailing list archives</H1>
<!-- IndexControl1="Start" -->
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<HR>
<!-- IndexControl1="End" -->
<!-- Header="Start" -->
<PRE>
  From: jonathan soong &lt;<I><A HREF="mailto:jon.soong@imvs.sa.gov.au">jon.soong@imvs.sa.gov.au</A></I>&gt;
  To  : &lt;<I><A HREF="mailto:linuxsa@linuxsa.org.au">linuxsa@linuxsa.org.au</A></I>&gt;
  Date: Mon, 17 Nov 2003 14:52:32 +1030
</PRE>
<H1>samba eating my processor</H1>
<!-- Header="End" -->
<!-- Body="Start" -->
<PRE>
Hi

Wondering if anyone can help me!

I've got a machine which shares out a samba directory that Windows 
clients write to and also run a program from. There are 10's of windows 
clients currently and they all run a program from this directory once a 
month and write a log file to it.

However, recently Samba has decided to eat my processor - This continues 
for some time and can only be stopped by killing the smbd processes.

PID USER     PRI  NI  SIZE  RSS SHARE STAT %CPU %MEM   TIME COMMAND
26258 www       19   0  3200 3200  2700 R    34.5  0.6  82:20 smbd
25781 www       20   0  3200 3200  2700 R    32.6  0.6  88:58 smbd
25165 www       18   0  3200 3200  2692 R    28.7  0.6  96:38 smbd
 1651 www       13   0  1028 1028   780 R     3.8  0.2   0:00 top
23424 root      10   0  1460 1460   964 S     0.9  0.2  15:27 nmbd

(smbd is taking 34.5, 32.6 and 28.7 CPU)

Running 'smbstatus' i find:
Locked files:
Pid    DenyMode   Access      R/W        Oplock           Name
--------------------------------------------------------------
25781  DENY_ALL   0x20089     RDONLY     EXCLUSIVE+BATCH  
/usr/windistrib/files/pcaudit/ALERTS.DAT   Mon Nov 17 14:46:33 2003
26258  DENY_NONE  0x20089     RDONLY     EXCLUSIVE+BATCH  
/usr/pcaudit-data/files/IHI35809.A2K   Mon Nov 17 14:46:33 2003
26258  DENY_WRITE 0x20        RDONLY     NONE             
/usr/windistrib/files/pcaudit/SCAN32.EXE   Mon Nov 17 09:13:18 2003
25781  DENY_WRITE 0x20        RDONLY     NONE             
/usr/windistrib/files/pcaudit/SCAN32.EXE   Mon Nov 17 08:52:09 2003
25165  DENY_WRITE 0x20        RDONLY     NONE             
/usr/windistrib/files/pcaudit/SCAN32.EXE   Mon Nov 17 08:25:00 2003
25781  DENY_NONE  0x20089     RDONLY     EXCLUSIVE+BATCH  
/usr/pcaudit-data/files/ITP35830.A2K   Mon Nov 17 14:46:33 2003
25165  DENY_NONE  0x20089     RDONLY     EXCLUSIVE+BATCH  
/usr/pcaudit-data/files/IIS35667.A2K   Mon Nov 17 14:46:33 2003

As can be seen - files seem to get locked and aren't released. It is 
2:29pm now and some files have been locked since 8:25 in the morning 
(and if i left it overnight they would be still locked tomorrow).

I'm currently using Samba 2.2.8..

Any help would be most appreciated :)

Cheers

Jon


-- 
LinuxSA WWW: <A HREF="http://www.linuxsa.org.au/">http://www.linuxsa.org.au/</A> IRC: #linuxsa on irc.freenode.net
To unsubscribe from the LinuxSA list:
  mail <A HREF="mailto:linuxsa-request@linuxsa.org.au">linuxsa-request@linuxsa.org.au</A> with "unsubscribe" as the subject

</PRE>
<!-- Body="End" -->
<!-- IndexControl2="Start" -->
<HR>
Index:
[<A HREF="thread.html">thread</A>]
[<A HREF="date.html">date</A>]
[<A HREF="subject.html">subject</A>]
[<A HREF="author.html">author</A>]
[<A HREF="stats.html">stats</A>]
<!-- IndexControl2="End" -->
<HR><FONT SIZE=+1>Return to the <A HREF=/mailing-list/>LinuxSA Mailing List Information</A> Page</FONT></BODY>
</HTML>
